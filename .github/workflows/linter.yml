name: 'Code checks'

on: [push]

env:
  cmssw_ver: CMSSW_10_2_10
  repo_url: https://github.com/Laurits7/Saving

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - run: echo ${{ github.repository }}
      - run: echo ${{ github.event_name}}
      - run: echo ${{ github.sha }}
      - run: echo ${{ env.repo_url}}/${{ github.event_name}}/${{ github.sha }}
      - name: Run docker Image
        env:
          build_image: clelange/cc7-cmssw-cvmfs:latest
          docker_options: --cap-add SYS_ADMIN --cap-add=MKNOD --security-opt apparmor=unconfined -e CVMFS_MOUNTS="cms.cern.ch" --device /dev/fuse -i
        run: |
            docker run ${{ env.docker_options }} ${{ env.build_image }} /bin/bash \
            -c 'source /cvmfs/cms.cern.ch/cmsset_default.sh && echo Succeeded to source || exit_on_error "Failed to source"!; \
             scramv1 project CMSSW ${{ env.cmssw_ver }}; cd ${{ env.cmssw_ver }}/src ; cmsenv ; \
             git clone ${{ env.repo_url}} $CMSSW_BASE/src/machineLearning/machineLearning'
        # Can't use the alias cmsrel, would need to echo it to .bashrc. Though this is the only place we need that alias.

# /commit/${{ github.sha }}

      #   run: |
      #     docker run \
      #     --cap-add SYS_ADMIN \
      #     --cap-add=MKNOD \
      #     --security-opt apparmor=unconfined \
      #     -e CVMFS_MOUNTS="cms.cern.ch" \
      #     --device /dev/fuse \
      #     -i clelange/cc7-cmssw-cvmfs:latest \
      #     /bin/bash
      # - name: Take a look around
      #   run: pwd && ls
      # - name: source
      #   run: ls /cvmfs


    # steps:
    # - uses: actions/checkout@v2
    # - name: Pull the Docker Image
    #   run: docker pull clelange/cc7-cmssw-cvmfs:latest
    # - name: Run Docker Image

    # container: clelange/cc7-cmssw-cvmfs:latest
    # steps:
    #   - name: Test
    #     run: source /cvmfs/cms.cern.ch/cmsset_default.sh


